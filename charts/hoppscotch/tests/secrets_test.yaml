suite: Secrets
templates:
  - secrets.yaml
values:
  - ../values.yaml
tests:
  - it: should render backend secrets
    template: secrets.yaml
    set:
      backend:
        databaseUrl: postgresql://user:password@example.com:5432/database
        jwtSecret: jwt-secret
        sessionSecret: session-secret
        dataEncryptionKey: data-encryption-key
        googleAuth:
          clientId: google-client-id
          clientSecret: google-client-secret
        githubAuth:
          clientId: github-client-id
          clientSecret: github-client-secret
        microsoftAuth:
          clientId: microsoft-client-id
          clientSecret: microsoft-client-secret
        mailer:
          smtpUrl: smtp://user:password@smtp.example.com:465
          smtpUser: smtp-user
          smtpPassword: smtp-password
      enterprise:
        licenseKey: enterprise-license-key
        backend:
          samlAuth:
            cert: |-
              -----BEGIN CERTIFICATE-----
              MIID...
              -----END CERTIFICATE-----
          oidcAuth:
            clientId: oidc-client-id
            clientSecret: oidc-client-secret
          clickhouse:
            user: clickhouse-user
            password: clickhouse-password
          redisUrl: redis://user:password@redis.example.com:6379
    documentIndex: 0
    asserts:
      - containsDocument:
          apiVersion: v1
          kind: Secret
      - equal:
          path: metadata.name
          value: release-name-hoppscotch
      - isNotNullOrEmpty:
          path: data.DATABASE_URL
      - isNotNullOrEmpty:
          path: data.JWT_SECRET
      - isNotNullOrEmpty:
          path: data.SESSION_SECRET
      - isNotNullOrEmpty:
          path: data.DATA_ENCRYPTION_KEY
      - isNotNullOrEmpty:
          path: data.GOOGLE_CLIENT_ID
      - isNotNullOrEmpty:
          path: data.GOOGLE_CLIENT_SECRET
      - isNotNullOrEmpty:
          path: data.GITHUB_CLIENT_ID
      - isNotNullOrEmpty:
          path: data.GITHUB_CLIENT_SECRET
      - isNotNullOrEmpty:
          path: data.MICROSOFT_CLIENT_ID
      - isNotNullOrEmpty:
          path: data.MICROSOFT_CLIENT_SECRET
      - isNotNullOrEmpty:
          path: data.MAILER_SMTP_URL
      - isNotNullOrEmpty:
          path: data.MAILER_SMTP_USER
      - isNotNullOrEmpty:
          path: data.MAILER_SMTP_PASSWORD
  - it: should render enterprise secrets
    template: secrets.yaml
    set:
      enterprise:
        licenseKey: enterprise-license-key
        backend:
          samlAuth:
            cert: |-
              -----BEGIN CERTIFICATE-----
              MIID...
              -----END CERTIFICATE-----
          oidcAuth:
            clientId: oidc-client-id
            clientSecret: oidc-client-secret
          clickhouse:
            user: clickhouse-user
            password: clickhouse-password
          redisUrl: redis://user:password@redis.example.com:6379
    documentIndex: 0
    asserts:
      - containsDocument:
          apiVersion: v1
          kind: Secret
      - equal:
          path: metadata.name
          value: release-name-hoppscotch
      - isNotNullOrEmpty:
          path: data.ENTERPRISE_LICENSE_KEY
      - isNotNullOrEmpty:
          path: data.SAML_CERT
      - isNotNullOrEmpty:
          path: data.OIDC_CLIENT_ID
      - isNotNullOrEmpty:
          path: data.OIDC_CLIENT_SECRET
      - isNotNullOrEmpty:
          path: data.CLICKHOUSE_USER
      - isNotNullOrEmpty:
          path: data.CLICKHOUSE_PASSWORD
      - isNotNullOrEmpty:
          path: data.REDIS_URL
